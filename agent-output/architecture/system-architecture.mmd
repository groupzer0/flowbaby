%% Cognee Chat Memory System Architecture Diagram (updated 2025-11-20)
graph TD
    subgraph VS_Code_Extension [VS Code Extension (TypeScript)]
    activation[extension.ts / activation]
    cogneeClient[CogneeClient
  (subprocess orchestration)]
    contextProvider[CogneeContextProvider
  (rate limits + formatting)]
    bgManager[BackgroundOperationManager
  (async cognify queue + ledger)]
    participant[@cognee-memory participant]
    agentCommands[Agent Commands
  (retrieveForAgent, future APIs)]
    lmTools[LanguageModelTools
  (Store/Retrieve UI tools)]
    outputLogs[Output channel + diagnostics]
    summaryModules[Summary Template & Parser
    (Plan 014 schema)]
    statusCmd[cognee.backgroundStatus
  (status surface)]
    end

  subgraph Python_Bridge [Python Bridge Scripts]
    init[init.py]
    ingest[ingest.py --mode sync/add-only
(legacy + enriched summaries)]
    cognifyOnly[ingest.py --mode cognify-only
(background process)]
    fallback[Enriched metadata markdown
(fallback until DataPoints)]
    retrieve[retrieve.py
(structured JSON + regex parsing)]
    future[Compaction / feedback hooks]
  end

  subgraph Cognee_SDK [Cognee SDK (cognee==0.4.0)]
    storage[Local graph/vector stores
(.cognee_system / .cognee_data)]
    cognition[Cognify + search pipelines]
  end

  ledger[.cognee/background_ops.json
(persisted operation ledger)]

  activation --> cogneeClient
  contextProvider --> cogneeClient
  cogneeClient --> bgManager
  contextProvider --> summaryModules
  summaryModules --> cogneeClient
  participant --> contextProvider
  agentCommands --> contextProvider
  lmTools --> contextProvider
  cogneeClient -->|JSON over stdout| ingest
  cogneeClient -->|JSON over stdout| retrieve
  bgManager --> cognifyOnly
  statusCmd --> bgManager
  bgManager --> ledger
  cognifyOnly --> ledger
  ingest --> fallback
  fallback --> retrieve
  Python_Bridge -->|Local API / FS| Cognee_SDK
  contextProvider --> outputLogs
