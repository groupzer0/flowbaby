# Architectural Findings – Plan 021 (v0.3.8 Memory Visibility & Trust)

**Date**: 2025-11-23 14:05 UTC  
**Architect**: GitHub Copilot (GPT-5.1-Codex Preview)

## Changelog
| Date & Time | Source | Request | Outcome |
|-------------|--------|---------|---------|
| 2025-11-23 14:05 | Planner | "Review plan 021 to ensure it aligns with the architecture." | Findings issued (APPROVED_WITH_CHANGES). |

## Verdict: **APPROVED_WITH_CHANGES**
Plan 021 largely follows the architectural direction captured in `system-architecture.md` (brand consistency, zero-hallucination safeguards, validation tooling, managed Python setup). However, two architectural gaps must be resolved before implementation, and one optional improvement is recommended.

---

## Required Changes

### 1. Zero-Hallucination Must Include Root-Cause Mitigation (Not Just Filtering)
- **Issue**: Milestone 2 only describes filtering 0.00-score results. Architecture Decision "RecallFlow Branding & Log Surfacing" and prior Plan 019 findings require identifying *why* graph queries fabricate answers (e.g., fallback LLM generations, stale enriched-text entries) and preventing those paths from running. Without a remediation track, filtering merely hides symptoms and does not satisfy the "Zero-Hallucination" epic intent.
- **Requirement**: Add tasks to (a) instrument the bridge to detect which retrieval branch produces fabricated responses, (b) either disable augmentation paths that inject LLM hallucinations or introduce an exact-match fallback, and (c) document any configuration knobs controlling thresholds. Include verification that fabricated payloads cannot reach TS even when the graph returns non-empty matches.

### 2. Refresh Workflow Must Coordinate with BackgroundOperationManager
- **Issue**: Milestone 4 follows the managed `.venv` design but omits the architectural requirement (§4.6.2) that `Refresh Bridge Dependencies` pause BackgroundOperationManager, drain or cancel running cognify jobs, and resume them only after verification. Without this, refresh can delete `.venv` while background processes still run, corrupting operations.
- **Requirement**: Explicitly add tasks to (a) pause the BackgroundOperationManager queue before rebuilding the environment, (b) write operation status to the ledger when refresh interrupts jobs, and (c) resume + emit notifications after hashes match. Acceptance criteria should confirm that refresh fails safely when managed queues are busy.

---

## Recommended Improvement

### Validate Tool Documentation & Configure Tools Copy During Brand Audit
- Architecture requires Configure Tools metadata, AGENT_INTEGRATION.md, and Output logging to reflect RecallFlow branding while internal IDs remain `cognee.*`. Milestone 1 mentions "Configure Tools descriptions" broadly; clarify that documentation (README, AGENT_INTEGRATION.md, architecture diagram) and tool metadata must be updated together to avoid drift.

---

## Pre-Conditions for Implementation
1. Update Plan 021 to incorporate the two required changes above.
2. Ensure QA checklist includes:
   - Retrieval hallucination regression tests (fabrication path disabled, 0.00-score filtering verified).
   - Managed environment refresh scenario with in-flight background operations.
3. After plan adjustments, update roadmap references to call out the new root-cause remediation tasks so downstream agents see the expanded scope.
